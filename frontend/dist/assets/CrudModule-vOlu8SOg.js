import{ag as _,aq as P,ai as L,a as m,ah as e}from"./index-HnWu2ajL.js";import{c as y}from"./actions-BZI40g3m.js";import{a as D,C as se}from"./index-EdnPnSX_.js";import{_ as O,D as Y,a0 as z,B as E,A as K,a3 as oe,C as ne,X as M,V as w,aw as le,E as ae,$ as re,L as ce,O as ie}from"./IdurarOs-BukodILd.js";import{d as F,P as de}from"./index-9o8rWx82.js";import{v as V,R as ue}from"./helpers-DB0-nE3e.js";import{M as pe}from"./index-Bsxqi8Iy.js";import{S as xe,c as me}from"./countryList-CAqrKrXm.js";import{s as Z}from"./index-KrFx5yLV.js";import{c as fe}from"./color-DHucoY0N.js";import{T as v}from"./index-BHMGiCbw.js";import{a as G,u as he}from"./useDate-VvBhK8L7.js";import{u as je}from"./useDebounce-B3EZk7FP.js";import{S as q,E as be}from"./index-_196Wt15.js";import{A as Ce,a as Se}from"./ArrowRightOutlined-C4tBAx2j.js";import{F as ge}from"./Table-BVAEfPyJ.js";import{f as ye,v as Te}from"./ErpApp-CHsvLNMM.js";import{D as Ie}from"./DeleteOutlined-COA9zE5v.js";import{P as Be}from"./PlusOutlined-zk98YPLA.js";import{s as W}from"./index-e0CX1Bw_.js";function De(){return ye()}const ve={useBreakpoint:De},N=o=>o.crud,X=_([N],o=>o.current),we=_([N],o=>o.list),Ae=_([N],o=>o.create),Le=_([N],o=>o.update);_([N],o=>o.read);const Ee=_([N],o=>o.delete),Fe=_([N],o=>o.search);function Oe({config:o,formElements:s,withUpload:c=!1}){let{entity:r}=o;const i=P(),{isLoading:n,isSuccess:t}=L(Ae),{crudContextAction:d}=D(),{panel:f,collapsedBox:b,readBox:h}=d,[u]=O.useForm(),l=Y(),a=x=>{x.file&&c&&(x.file=x.file[0].originFileObj),i(y.create({entity:r,jsonData:x,withUpload:c}))};return m.useEffect(()=>{t&&(h.open(),b.open(),f.open(),u.resetFields(),i(y.resetAction({actionType:"create"})),i(y.list({entity:r})))},[t]),e.jsx(z,{isLoading:n,children:e.jsxs(O,{form:u,layout:"vertical",onFinish:a,children:[s,e.jsx(O.Item,{children:e.jsx(E,{type:"primary",htmlType:"submit",children:l("Submit")})})]})})}function _e({config:o,formElements:s,withUpload:c=!1}){let{entity:r}=o;const i=Y(),n=P(),{current:t,isLoading:d,isSuccess:f}=L(Le),{state:b,crudContextAction:h}=D(),{panel:u,collapsedBox:l,readBox:a}=h,x=()=>{a.open()},[j]=O.useForm(),S=p=>{const g=t._id;p.file&&c&&(p.file=p.file[0].originFileObj),n(y.update({entity:r,id:g,jsonData:p,withUpload:c}))};m.useEffect(()=>{if(t){let p={...t};p.birthday&&(p={...p,birthday:F(p.birthday).format("YYYY-MM-DDTHH:mm:ss.SSSZ")}),p.date&&(p={...p,date:F(p.date).format("YYYY-MM-DDTHH:mm:ss.SSSZ")}),p.expiredDate&&(p={...p,expiredDate:F(p.expiredDate).format("YYYY-MM-DDTHH:mm:ss.SSSZ")}),p.created&&(p={...p,created:F(p.created).format("YYYY-MM-DDTHH:mm:ss.SSSZ")}),p.updated&&(p={...p,updated:F(p.updated).format("YYYY-MM-DDTHH:mm:ss.SSSZ")}),j.resetFields(),j.setFieldsValue(p)}},[t]),m.useEffect(()=>{f&&(a.open(),l.open(),u.open(),j.resetFields(),n(y.resetAction({actionType:"update"})),n(y.list({entity:r})))},[f]);const{isEditBoxOpen:C}=b,T=C?{display:"block",opacity:1}:{display:"none",opacity:0};return e.jsx("div",{style:T,children:e.jsx(z,{isLoading:d,children:e.jsxs(O,{form:j,layout:"vertical",onFinish:S,children:[s,e.jsx(O.Item,{style:{display:"inline-block",paddingRight:"5px"},children:e.jsx(E,{type:"primary",htmlType:"submit",children:i("Save")})}),e.jsx(O.Item,{style:{display:"inline-block",paddingLeft:"5px"},children:e.jsx(E,{onClick:x,children:i("Cancel")})})]})})})}function Pe({config:o}){const s=Y(),{entity:c,deleteModalLabels:r,deleteMessage:i=s("are_you_sure_you_want_to_delete"),modalTitle:n=s("delete_confirmation")}=o,t=P(),{current:d,isLoading:f,isSuccess:b}=L(Ee),{state:h,crudContextAction:u}=D(),{appContextAction:l}=K(),{panel:a,readBox:x}=u,{navMenu:j}=l,{isModalOpen:S}=h,{modal:C}=u,[T,p]=m.useState("");m.useEffect(()=>{if(b&&(C.close(),t(y.list({entity:c}))),d){let A=r.map(R=>V(d,R)).join(" ");p(A)}},[b,d]);const g=()=>{const A=d._id;t(y.delete({entity:c,id:A})),x.close(),C.close(),a.close(),j.collapse()},B=()=>{f||C.close()};return e.jsx(pe,{title:n,open:S,onOk:g,onCancel:B,confirmLoading:f,children:e.jsxs("p",{children:[i,T]})})}const Ne=({fields:o,translate:s})=>{let c=[];return Object.keys(o).forEach(r=>{let i=o[r];c.push({title:i.label?i.label:r,dataIndex:i.dataIndex?i.dataIndex.join("."):r,isDate:i.type==="date"})}),c};function Ye({fields:o,translate:s,moneyFormatter:c,dateFormat:r}){let i=[];return Object.keys(o).forEach(n=>{let t=o[n];const d=t.dataIndex?t.dataIndex:[n],f={boolean:{title:t.label?s(t.label):s(n),dataIndex:d,onCell:()=>({props:{style:{width:"60px"}}}),render:(u,l)=>e.jsx(xe,{checked:l[n],checkedChildren:e.jsx(oe,{}),unCheckedChildren:e.jsx(ne,{})})},date:{title:t.label?s(t.label):s(n),dataIndex:d,render:(u,l)=>{const a=F(l[n]).format(r);return e.jsx(v,{bordered:!1,color:t.color,children:a})}},currency:{title:t.label?s(t.label):s(n),dataIndex:d,onCell:()=>({style:{textAlign:"right",whiteSpace:"nowrap"}}),render:(u,l)=>c({amount:l[n],currency_code:l.currency})},async:{title:t.label?s(t.label):s(n),dataIndex:d,render:(u,l)=>{var a;return e.jsx(v,{bordered:!1,color:t.color||((a=l[n])==null?void 0:a.color)||l.color,children:u})}},color:{title:t.label?s(t.label):s(n),dataIndex:d,render:(u,l)=>{var a;return e.jsx(v,{bordered:!1,color:u,children:(a=fe.find(x=>x.value===u))==null?void 0:a.label})}},stringWithColor:{title:t.label?s(t.label):s(n),dataIndex:d,render:(u,l)=>e.jsx(v,{bordered:!1,color:l.color||t.color,children:u})},tag:{title:t.label?s(t.label):s(n),dataIndex:d,render:(u,l)=>e.jsx(v,{bordered:!1,color:t.color,children:l[n]&&l[n]})},selectWithFeedback:{title:t.label?s(t.label):s(n),dataIndex:d,render:(u,l)=>{if(t.renderAsTag){const a=t.options.find(x=>x.value===l[n]);return e.jsx(v,{bordered:!1,color:a==null?void 0:a.color,children:l[n]&&s(l[n])})}else return l[n]&&s(l[n])}},select:{title:t.label?s(t.label):s(n),dataIndex:d,render:(u,l)=>{if(t.renderAsTag){const a=t.options.find(x=>x.value===l[n]);return e.jsx(v,{bordered:!1,color:a==null?void 0:a.color,children:l[n]&&l[n]})}else return l[n]&&l[n]}},selectWithTranslation:{title:t.label?s(t.label):s(n),dataIndex:d,render:(u,l)=>{if(t.renderAsTag){const a=t.options.find(x=>x.value===l[n]);return e.jsx(v,{bordered:!1,color:a==null?void 0:a.color,children:l[n]&&s(l[n])})}else return l[n]&&s(l[n])}},array:{title:t.label?s(t.label):s(n),dataIndex:d,render:(u,l)=>l[n].map(a=>e.jsx(v,{bordered:!1,color:t.colors[a],children:a},`${Z.generate()}`))},country:{title:t.label?s(t.label):s(n),dataIndex:d,render:(u,l)=>{const a=me.find(x=>x.value===l[n]);return e.jsxs(v,{bordered:!1,color:t.color||void 0,children:[(a==null?void 0:a.icon)&&(a==null?void 0:a.icon)+" ",(a==null?void 0:a.label)&&s(a.label)]})}}},b={title:t.label?s(t.label):s(n),dataIndex:d},h=t.type;t.disableForTable||(Object.keys(f).includes(h)?i.push(f[h]):i.push(b))}),i}function Me({config:o}){const{dateFormat:s}=G();let{readColumns:c,fields:r}=o;const i=Y(),{result:n}=L(X),{state:t}=D(),{isReadBoxOpen:d}=t,[f,b]=m.useState([]);r&&(c=[...Ne({fields:r,translate:i})]),m.useEffect(()=>{const l=[];c.map(a=>{const x=a.dataIndex,j=a.title,S=a.isDate||!1;let C=V(n,x);C=S?F(C).format(s):C,l.push({propsKey:x,label:j,value:C})}),b(l)},[n]);const h=d?{display:"block",opacity:1}:{display:"none",opacity:0},u=f.map(l=>e.jsxs(M,{gutter:12,children:[e.jsx(w,{className:"gutter-row",span:8,children:e.jsx("p",{children:l.label})}),e.jsx(w,{className:"gutter-row",span:2,children:e.jsx("p",{children:" : "})}),e.jsx(w,{className:"gutter-row",span:14,children:e.jsx("p",{children:l.value})})]},l.propsKey));return e.jsx("div",{style:h,children:u})}function Re({config:o,onRerender:s}){let{entity:c,searchConfig:r}=o;const{displayLabels:i,searchFields:n,outputValue:t="_id"}=r,d=P(),{crudContextAction:f}=D(),{panel:b,collapsedBox:h,readBox:u}=f,{result:l,isLoading:a,isSuccess:x}=L(Fe),[j,S]=m.useState([]),[C,T]=m.useState(void 0),p=m.useRef(!1),[g,B]=m.useState(!1),[A,R]=m.useState(""),[H,J]=m.useState(""),[,Q]=je(()=>{J(A)},500,[A]),U=I=>i.map($=>I[$]).join(" ");m.useEffect(()=>{if(H!=""){const I={q:H,fields:n};d(y.search({entity:c,options:I}))}return()=>{Q()}},[H]);const k=I=>{I&&I!=""&&(p.current=!0,B(!0),S([]),T(void 0),R(I))},ee=I=>{const $=l.find(te=>te[t]===I);d(y.currentItem({data:$})),b.open(),h.open(),u.open(),s()};return m.useEffect(()=>{p.current&&(x?S(l):(B(!1),T(void 0),S([])))},[x,l]),e.jsx(q,{loading:a,showSearch:!0,allowClear:!0,placeholder:e.jsx(le,{style:{float:"right",padding:"8px 0"}}),defaultActiveFirstOption:!1,filterOption:!1,notFoundContent:g?"... Searching":e.jsx(be,{}),value:C,onSearch:k,style:{width:"100%"},onSelect:ee,children:j.map(I=>e.jsx(q.Option,{value:I[t],children:U(I)},I[t]))})}function He({config:o}){const[s,c]=m.useState([0]),r=()=>{c([s+1])};return s.map(i=>e.jsx(Re,{config:o,onRerender:r},i))}function $e({config:o}){const{crudContextAction:s}=D(),{collapsedBox:c,panel:r}=s,{ADD_NEW_ENTITY:i}=o,n=()=>{r.open(),c.close()};return e.jsx(E,{onClick:n,type:"primary",children:i})}function We({config:o,extra:s=[]}){let{entity:c,dataTableColumns:r,DATATABLE_TITLE:i,fields:n,searchConfig:t}=o;D();const d=Y(),{moneyFormatter:f}=he(),{dateFormat:b}=G();let h=[];n?h=[...Ye({fields:n,translate:d,moneyFormatter:f,dateFormat:b})]:h=[...r],r=[...h];const{result:u,isLoading:l}=L(we),{pagination:a,items:x}=u,j=P(),S=m.useCallback(g=>{const B={page:g.current||1,items:g.pageSize||10};j(y.list({entity:c,options:B}))},[j,c]),C=g=>{const A={q:g.target.value,fields:(t==null?void 0:t.searchFields)||""};j(y.list({entity:c,options:A}))},T=()=>{j(y.list({entity:c}))};m.useEffect(()=>{const g=new AbortController;return T(),()=>{g.abort()}},[j,c]);const p=L(ae);return e.jsxs(e.Fragment,{children:[e.jsx(de,{onBack:()=>window.history.back(),backIcon:p==="rtl"?e.jsx(Ce,{}):e.jsx(Se,{}),title:i,ghost:!1,extra:[e.jsx(re,{onChange:C,placeholder:d("search"),allowClear:!0},"searchFilterDataTable"),e.jsx(E,{onClick:S,icon:e.jsx(ue,{}),children:d("Refresh")},`${Z.generate()}`),e.jsx($e,{config:o},`${Z.generate()}`)],style:{padding:"20px 0px",direction:p}}),e.jsx(ge,{columns:r,rowKey:g=>g._id,dataSource:x,pagination:a,loading:l,onChange:S,scroll:{x:!0}})]})}function Ze({children:o}){return e.jsx(se,{children:o})}const qe=({onChange:o,title:s})=>e.jsx("div",{className:"collapseBoxHeader",onClick:o,children:s}),ze=({isOpen:o,children:s})=>{const c=o?{display:"block",opacity:1}:{display:"none",opacity:0};return e.jsx("div",{className:"TopCollapseBox",children:e.jsx("div",{style:c,children:e.jsx(M,{children:e.jsxs(w,{span:24,children:[" ",s]})})})})},Ke=({isOpen:o,children:s})=>{const c=o?{display:"none",opacity:0}:{display:"block",opacity:1};return e.jsx("div",{className:"BottomCollapseBox",children:e.jsx("div",{style:c,children:e.jsx(M,{children:e.jsxs(w,{span:24,children:[" ",s]})})})})};function Ve({topContent:o,bottomContent:s,buttonTitle:c,isCollapsed:r,onCollapse:i}){const n=r?"collapsed":"";return e.jsxs(e.Fragment,{children:[e.jsx(ze,{isOpen:r,children:o}),e.jsxs("div",{className:"collapseBox "+n,children:[e.jsx(qe,{title:c,onChange:i}),e.jsx("div",{className:"whiteBg"}),e.jsx(Ke,{isOpen:r,children:s})]})]})}const{useBreakpoint:Ge}=ve;function Xe({config:o,topContent:s,bottomContent:c,fixHeaderPanel:r}){Ge();const{ADD_NEW_ENTITY:i}=o,{state:n,crudContextAction:t}=D(),{isPanelClose:d,isBoxCollapsed:f}=n,{panel:b,collapsedBox:h}=t,[u,l]=m.useState(d),[a,x]=m.useState("-1px"),[j,S]=m.useState(0),[C,T]=m.useState("20px");m.useEffect(()=>{let B=[];return d?(S(0),T("20px"),B=setTimeout(()=>{x("-1px"),l(d)},200)):(l(d),x(0),B=setTimeout(()=>{S(1),T(0)},200)),()=>clearTimeout(B)},[d]);const p=()=>{b.collapse()},g=()=>{h.collapse()};return e.jsx(Te,{title:o.PANEL_TITLE,placement:"right",onClose:p,open:!d,width:450,children:e.jsxs("div",{className:"sidePanelContent",style:{opacity:j,paddingTop:C},children:[r,e.jsx(Ve,{buttonTitle:i,isCollapsed:f,onCollapse:g,topContent:s,bottomContent:c})]})})}const{Content:Je}=ce,Qe=({children:o})=>{const{state:s,crudContextAction:c}=D();K();const{isPanelClose:r}=s,[i,n]=m.useState(r);return m.useEffect(()=>{let t=[];return r?t=setTimeout(()=>{n(r)},200):n(r),()=>clearTimeout(t)},[r]),e.jsx(Je,{className:"whiteBox shadow layoutPadding",style:{margin:"30px auto",width:"100%",maxWidth:"100%",flex:"none"},children:o})};function Ue({children:o,config:s,sidePanelTopContent:c,sidePanelBottomContent:r,fixHeaderPanel:i}){return e.jsx(e.Fragment,{children:e.jsxs(Ze,{children:[e.jsx(Xe,{config:s,topContent:c,bottomContent:r,fixHeaderPanel:i}),e.jsxs(Qe,{children:[" ",o]})]})})}function ke({config:o,formElements:s,withUpload:c}){const r=Y(),{crudContextAction:i,state:n}=D(),{deleteModalLabels:t}=o,{modal:d,editBox:f}=i,{isReadBoxOpen:b,isEditBoxOpen:h}=n,{result:u}=L(X),l=P(),[a,x]=m.useState("");m.useEffect(()=>{if(u){const T=t.map(p=>u[p]).join(" ");x(T)}},[u]);const j=()=>{u?window.confirm(`Are you sure you want to delete ${a}?`)&&(l(y.currentAction({actionType:"delete",data:u})),W.success("Item deleted successfully!"),d.close()):W.error("No item selected for deletion.")},S=()=>{u?(l(y.currentAction({actionType:"update",data:u})),f.open()):W.error("No item selected for editing.")},C=b||h?{opacity:1}:{opacity:0};return e.jsxs(e.Fragment,{children:[e.jsxs(M,{style:C,gutter:[24,24],children:[e.jsx(w,{span:10,children:e.jsx("p",{style:{marginBottom:"10px"},children:a})}),e.jsxs(w,{span:14,children:[e.jsx(E,{onClick:j,type:"text",icon:e.jsx(Ie,{}),size:"small",style:{float:"right",marginLeft:"5px",marginTop:"10px"},children:r("remove")}),e.jsx(E,{onClick:S,type:"text",icon:e.jsx(ie,{}),size:"small",style:{float:"right",marginTop:"10px"},children:r("edit")})]}),e.jsx(w,{span:24,children:e.jsx("div",{className:"line"})})]}),e.jsx(Me,{config:o}),e.jsx(_e,{config:o,formElements:s,withUpload:c})]})}function et({config:o}){const{crudContextAction:s}=D(),{collapsedBox:c}=s,r=()=>{c.close()};return e.jsxs(M,{gutter:8,children:[e.jsx(w,{className:"gutter-row",span:21,children:e.jsx(He,{config:o})}),e.jsx(w,{className:"gutter-row",span:3,children:e.jsx(E,{onClick:r,block:!0,icon:e.jsx(Be,{})})})]})}function gt({config:o,createForm:s,updateForm:c,withUpload:r=!1}){const i=P();return m.useLayoutEffect(()=>{i(y.resetState())},[i]),e.jsxs(Ue,{config:o,fixHeaderPanel:e.jsx(et,{config:o}),sidePanelBottomContent:e.jsx(Oe,{config:o,formElements:s,withUpload:r}),sidePanelTopContent:e.jsx(ke,{config:o,formElements:c,withUpload:r}),children:[e.jsx(We,{config:o}),e.jsx(Pe,{config:o})]})}export{gt as C,X as s};
